# SpringCloud学习文档

## 一、系统架构演变//todo

### 1.1 集中式架构

### 1.2 垂直拆分

### 1.3 分布式服务

### 1.4 面向服务（SOA）

### 1.5 微服务

## 二、服务调用方式

### 2.1 RPC和HTTP

无论是微服务还是SOA，都面临着服务间的远程调用。

常见的远程调用方式有以下2种：

**RPC**：Remote Produce Call远程过程调用，**RPC基于Socket，工作在会话层。自定义数据格式**，速度快，效率高。早期的webservice，现在热门的dubbo，都是RPC的典型代表。

**Http**：http其实是**一种网络传输协议，基于TCP，工作在应用层，规定了数据传输的格式**。现在客户端浏览器与服务端通信基本都是采用Http协议，也可以用来进行远程服务调用。缺点是消息封装臃肿，优势是对服务的提供和调用方没有任何技术限定，自由灵活，更符合微服务理念。

> **区别**：RPC的机制是根据语言的API（language API）来定义的，而不是根据基于网络的应用来定义的。如果公司全部采用Java技术栈，那么使用Dubbo作为微服务架构是一个不错的选择。相反，如果公司的技术栈多样化，而且你更青睐Spring家族，那么Spring Cloud搭建微服务是不二之选。

### 2.2 Http客户端工具

既然微服务选择了Http，那么我们就需要考虑自己来实现对请求和响应的处理。不过开源世界已经有很多的http客户端工具，能够帮助我们做这些事情，例如：

HttpClient

OKHttp

URLConnection

不过这些不同的客户端，API各不相同。而Spring也有对http的客户端进行封装，提供了工具类叫RestTemplate。

## 三、SpringCloud&SpringCloudAlibaba简介

**Spring Cloud**是Spring旗下的项目之一，Spring最擅长的就是集成，把世界上最好的框架拿过来，集成到自己的项目中。Spring Cloud也是一样，它将现在非常流行的一些技术整合到一起，实现了诸如：配置管理，服务发现，智能路由，负载均衡，熔断器，控制总线，集群状态等功能；协调分布式环境中各个系统，为各类服务提供模板性配置。其主要涉及的组件包括：

Eureka：注册中心

Zuul、Gateway：服务网关

Ribbon：负载均衡

Feign：服务调用

Hystrix或Resilience4j：熔断器

**Spring Cloud Alibaba** 旨在为微服务开发提供一站式解决方案。该项目包含了开发分布式应用和服务所需的组件，让开发者可以使用Spring Cloud编程模型轻松开发分布式应用。

使用Spring Cloud Alibaba，您只需要添加一些注解和配置，您就可以在您的应用中使用阿里巴巴的分布式解决方案，并通过阿里巴巴中间件构建您自己的分布式系统。

Spring Cloud 阿里巴巴的特点：

1. **流量控制和服务降级**：支持WebServlet、WebFlux、OpenFeign、RestTemplate、Dubbo接入限流降级功能。可以在运行时通过控制台实时修改限流和降级规则，同时支持限流Metrics的监控。
2. **服务注册和发现**：可以注册服务，客户端可以使用 Spring 管理的 bean，自动集成 Ribbon 来发现实例。
3. **分布式配置**：支持分布式系统中的外化配置，配置改变时自动刷新。
4. **Rpc Service**：扩展 Spring Cloud 客户端 RestTemplate 和 OpenFeign 以支持调用 Dubbo RPC 服务。
5. **事件驱动**：支持构建与共享消息系统连接的高度可扩展的事件驱动微服务。
6. **分布式事务**：支持高性能、易用的分布式事务解决方案。
7. **阿里云对象存储**：海量、安全、低成本、高可靠的云存储服务。支持随时随地在任何应用程序中存储和访问任何类型的数据。
8. **阿里云SchedulerX**：精准、高可靠、高可用的定时作业调度服务，响应时间秒级。
9. **阿里云短信**：覆盖全球的短信服务，阿里短信提供便捷、高效、智能的通讯能力，帮助企业快速联系客户。

Spring Cloud Alibaba是阿里巴巴公司基于Spring Cloud标准实现一套微服务开发框架集合，它和Netflflix一样都是Spring Cloud微服务开发实现方案。

### 3.1 微服务场景模拟//todo

## 四、服务发现与配置管理Nacos

### 4.1 区别与选型

EureKa已停止更新，本文档只学习Nacos

> Nacos与Eureka均提供注册中心和服务治理功能，以下为两者差异和选型方案。
>
> **功能差异**
>
> | 模块     | Nacos | Eureka | 说明                                                         |
> | -------- | ----- | ------ | ------------------------------------------------------------ |
> | 注册中心 | 是    | 是     | 服务治理基本功能，负责服务中心化注册                         |
> | 配置中心 | 是    | `否`   | Eureka需要配合Config实现配置中心，且不提供管理界面           |
> | 动态刷新 | 是    | `否`   | Eureka需要配合MQ实现配置动态刷新，Nacos采用Netty保持TCP长连接实时推送 |
> | 可用区AZ | 是    | 是     | 对服务集群划分不同区域，实现区域隔离，并提供容灾自动切换     |
> | 分组     | 是    | `否`   | Nacos可用根据业务和环境进行分组管理                          |
> | 元数据   | 是    | 是     | 提供服务标签数据，例如环境或服务标识                         |
> | 权重     | 是    | `否`   | Nacos默认提供权重设置功能，调整承载流量压力                  |
> | 健康检查 | 是    | 是     | Nacos支持由客户端或服务端发起的健康检查，Eureka是由客户端发起心跳 |
> | 负载均衡 | 是    | 是     | 均提供负责均衡策略，Eureka采用Ribion                         |
> | 管理界面 | 是    | `否`   | Nacos支持对服务在线管理，Eureka只是预览服务状态              |
>
> **部署安装**
>
> | 模块     | Nacos    | Eureka                  | 说明                                   |
> | -------- | -------- | ----------------------- | -------------------------------------- |
> | MySql    | 是       | `否`                    | Nacos需要采用MySql进行数据进行持久化   |
> | MQ       | `否`     | 是                      | Eureka需要采用MQ进行配置中心刷新       |
> | 配置中心 | 是       | `否`                    | Eureka结合Config或者Consul实现配置中心 |
> | 配置文件 | 在线编辑 | 本地文件或者Git远程文件 | Eureka结合Config或者Consul             |
> | 集群     | 是       | 是                      | Nacos需要配置集群ip再启动              |
>
> **稳定及扩展性**
>
> | 模块     | Nacos    | Eureka  | 说明                                                         |
> | -------- | -------- | ------- | ------------------------------------------------------------ |
> | 版本     | 1.0.0    | 1.9.9   | Eureka2.0已停止开发,Nacos处于1.x-2.0开发                     |
> | 厂商     | 阿里巴巴 | Netflix | Netflix已长期用于生产,阿里刚起步                             |
> | 生产建议 | `否`     | 是      | Nacos0.8以前不可用于生产,建议生产采用Nacos1.0,便于节省配置中心集群和服务管理 |
> | 未来发展 | 是       | `否`    | Nacos 2.0主要关注在统一服务管理、服务共享及服务治理体系的开放的服务平台的建设 |























